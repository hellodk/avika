#!/bin/bash

# Simple secret detection regexes
SECRETS_PATTERN="(?:access_key|secret_key|api_key|password|passwd|pwd|token|auth|key|secret)[[:space:]]*[:=][[:space:]]*[\"'][^\"']+[\"']"

# Find staged files
STAGED_FILES=$(git diff --cached --name-only)

for file in $STAGED_FILES; do
    if grep -Ei "$SECRETS_PATTERN" "$file" > /dev/null; then
        echo "ERROR: Potential secret detected in $file"
        grep -Ein "$SECRETS_PATTERN" "$file"
        echo "Commit aborted. Please remove secrets or bypass with --no-verify if it's a false positive."
        exit 1
    fi
done

echo "Pre-commit checks passed."
exit 0
