# =============================================================================
# Avika NGINX Manager Agent Configuration
# =============================================================================
# Copy this file to /etc/avika/avika-agent.conf
# See deploy/config/avika-agent.conf.sample for full documentation

# -----------------------------------------------------------------------------
# GATEWAY CONNECTION
# -----------------------------------------------------------------------------

# Gateway address(es) - single value or comma-separated for multi-gateway HA mode
# Examples:
#   Single gateway:  GATEWAYS="gateway.example.com:5020"
#   Multi-gateway:   GATEWAYS="gw1.example.com:5020,gw2.example.com:5020"
#   Kubernetes:      GATEWAYS="avika-gateway.avika.svc.cluster.local:5020"
GATEWAYS="192.168.1.10:5020,avika-gateway.labs.svc.cluster.local:5020,avika-gateway.avika.svc.cluster.local:5020"

# -----------------------------------------------------------------------------
# AGENT IDENTITY
# -----------------------------------------------------------------------------

# Agent ID (leave empty for auto-detection: hostname+IP)
AGENT_ID=""

# -----------------------------------------------------------------------------
# NETWORK PORTS
# -----------------------------------------------------------------------------

# Health check endpoint port (/healthz, /readyz)
HEALTH_PORT=5026

# Management gRPC service port
MGMT_PORT=5025

# -----------------------------------------------------------------------------
# NGINX CONFIGURATION
# -----------------------------------------------------------------------------

# NGINX main config file path
NGINX_CONFIG_PATH="/etc/nginx/nginx.conf"

# NGINX stub_status endpoint URL
NGINX_STATUS_URL="http://127.0.0.1/nginx_status"

# -----------------------------------------------------------------------------
# LOG COLLECTION
# -----------------------------------------------------------------------------

# NGINX log paths
ACCESS_LOG_PATH="/var/log/nginx/access.log"
ERROR_LOG_PATH="/var/log/nginx/error.log"

# Log format: "combined" or "json"
LOG_FORMAT="combined"

# -----------------------------------------------------------------------------
# DATA PERSISTENCE
# -----------------------------------------------------------------------------

# WAL buffer directory (for message persistence)
BUFFER_DIR="/var/lib/avika/"

# NGINX config backup directory
BACKUP_DIR="/var/lib/avika/backups"

# -----------------------------------------------------------------------------
# SELF-UPDATE
# -----------------------------------------------------------------------------

# Update server URL
# By default, agents fetch updates from the gateway server on port 5021
# The gateway serves updates at /updates/ (e.g., http://gateway:5021/updates)
# Leave empty to disable self-updates, or override with a custom update server URL
#
# Examples:
#   Gateway-based (default): UPDATE_SERVER=""  (auto-derived from first gateway)
#   Custom server:           UPDATE_SERVER="http://updates.example.com:8090"
#   Disable updates:         UPDATE_SERVER="disabled"
UPDATE_SERVER=""

# Update check interval (Go duration format)
UPDATE_INTERVAL="168h"

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------

# Log level: debug, info, warn, error
LOG_LEVEL="info"

# Log file path
# - Containers/Kubernetes: Leave empty (stdout) - logs captured by container runtime
# - VMs with systemd: Leave empty (stdout) - logs captured by journald
# - VMs without systemd: Set path like "/var/log/avika/agent.log"
# The agent auto-creates the directory if it doesn't exist.
LOG_FILE=""
